<!DOCTYPE html>
<html>

<head>
	<title>Police Violence Happens Here - ACLU of Massachusetts</title>

	<!-- Add favicon -->
	<link rel="shortcut icon" href="https://data.aclum.org/sjc-12926-tracker/favicon.ico">
	<link rel="icon" type="image/png" sizes="512x512" href="https://data.aclum.org/sjc-12926-tracker/favicon.png">

    <!-- Very important to make mobile work right!! -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- Load Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <!-- Load PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" integrity="sha512-rKFvwjvE4liWPlFnvH4ZhRDfNZ9FOpdkD/BU5gAIA3VS3vOQrQ5BjKgbO3kxebKhHdHcNUHLqxQYSoxee9UwgA==" crossorigin="anonymous"></script>
    <!-- Load FontAwesome -->
    <script src="https://kit.fontawesome.com/7fb5d02cd4.js" crossorigin="anonymous"></script>
    <!-- Load custom CSS -->
    <link rel="stylesheet" href="it-happens-here-database.css" />
</head>

<div id = "header">

<img id="ihh-logo" src="img/ihh_logo.png" alt="Police Violence Happens Here">

</div>

<div id="content">

	<p style="text-align:center"><em>An initiative by the <a href="aclum.org" target="_blank">ACLU of Massachusetts</a></em></p>

	<p>Massachusetts is not immune to police violence and misconduct - and we must demand change. Right now, legislators in Massachusetts have the unprecedented opportunity to end qualified immunity, impose real restrictions on use of force, and ban police use of face surveillance technology. Police violence happens here: help us demand an end to it in Massachusetts.</p>

	This database shows incidents of alleged police violence (red) and alleged misconduct 
		     	(blue) that occurred in Massachusetts since 2000. Descriptions are drawn 
		     	from contemporaneous sources. This is not an exhaustive list, and locations 
		     	are not meant to be exact.

	<div class="cards-container row"></div>

</div>

<script type='text/javascript' src='apikey.js'></script>
<script>



	let SHEET_ID = '1WgKitw1ggr9VO9Wg_K50G7t4L-uP_dr3vi7drUcPPbU'; // Get this from the main sheet URL (not the copied Publish URL with '2PACX' in it).
	let API_KEY = google_sheets_api_key;
	var spreadsheetId = SHEET_ID
	var sheetName = 'Incidents'
	var apiKey = API_KEY
	var url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;

	fetch(url)
		.then(response => response.json())
		.then(json_result => Papa.parse(Papa.unparse(json_result.values), { header: true }))
		.then(data => {
			// console.log(data)
			createCards(data)
		})

	function createCards(data) {

		card_container = document.getElementsByClassName("cards-container")[0]

		for (incident in data.data) {
			console.log(data.data[incident])
			incident_data = data.data[incident]

			let id = incident_data.VictimName.replace(/\s/g, '-').toLowerCase()  + '-' + incident_data.IncidentDate_Num
			incident_url = "https://data.aclum.org/it-happens-here/?id=" + id

			if (incident_data.VictimRace == "White") {
		        var race = "white";
		      } else if (incident_data.VictimRace == "Unknown") {
		        var race = "";
		      } else {
		        var race = incident_data.VictimRace;
		      }

		      if (incident_data.VictimGender == "Male" & incident_data.VictimAge >= 18) {
		        gender = " man"
		      } else if (incident_data.VictimGender == "Male" & incident_data.VictimAge < 18) {
		         gender = " boy"
		      } else if (incident_data.VictimGender == "Female" & incident_data.VictimAge >= 18) {
		         gender = " woman"
		      } else if (incident_data.VictimGender == "Female" & incident_data.VictimAge < 18) {
		        gender = " girl"
		      } else {
		        gender = " person"
		      }

		      if (incident_data.VictimAge.toLowerCase().trim() == "unknown") {
		        var demographics = race + gender + " of unknown age"   
		        demographics = demographics.trim()     
		        demographics = demographics.charAt(0).toUpperCase() + demographics.slice(1);
		      } else {
		        var demographics = incident_data.VictimAge + "-year-old " + race + gender
		      }

			let card_div = document.createElement("div"); 
			card_div.className = "col-md-6"
        	card_div.innerHTML = `
		        	<div class="card">
		        	<div class="card-header">
					    ${incident_data.IncidentType}
					  </div>
				  <div class="card-body">
				    <h5 class="card-title">${incident_data.VictimName}</h5>
				    <h6 class="card-subtitle mb-2 text-muted">${demographics}</h6>

				  <div class="card-text">
			    	        <div><b>Date of Incident:</b> ${incident_data.IncidentDate}</div>
			    	        <div><b>Location:</b> ${incident_data.City}</div>
			    	        <div><b>Police Department:</b> ${incident_data.PoliceDept}</div>
			    	        <div><b>Officer(s) Involved:</b> ${incident_data.OfficerName}</div>
			            <p class="incident-description">
			            	${incident_data.Description}
			            </p>
			            <i>Source: <a id="news-source" target="_blank" href="${incident_data.ArticleURL}">${incident_data.ArticleSource}</a></i>
			            </div>

			            <div style="text-align:right;"><a class="btn btn-dark" href="${incident_url}" target="blank" role="button">See on map</a></div>
				  </div>
				  </div>
				`

			card_container.appendChild(card_div)

		}

	}

</script>

</html>
